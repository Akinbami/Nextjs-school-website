{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useRef } from 'react'; // import ReactQuill from 'react-quill';\n\nimport Link from 'next/link';\nimport Head from 'next/head';\nimport dynamic from 'next/dynamic';\nimport LoadingOverlay from 'react-loading-overlay';\nimport { useCookies } from 'react-cookie';\nimport cookies from 'next-cookies';\nimport fetch from 'isomorphic-unfetch';\nimport Router, { useRouter } from 'next/router';\nimport AdminLayout from '../../components/AdminLayout';\nimport MainNav from '../../components/AdminMainNav'; // import 'react-quill/dist/quill.snow.css'\n// import FormHtmlEditor from '../components/FormHtmlEditor'\n\nvar ReactQuill = true ? require('react-quill') : function () {\n  return false;\n};\nvar QuillNoSSRWrapper = dynamic(function () {\n  return import('react-quill');\n}, {\n  ssr: false,\n  loading: function loading() {\n    return __jsx(\"p\", null, \"Loading ...\");\n  },\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('react-quill')];\n    },\n    modules: ['react-quill']\n  }\n});\nvar POST_API = \"https://gwh3ump9m0.execute-api.us-east-2.amazonaws.com/prod/api/posts\";\nvar apiBaseURL = \"https://z2evkvjux4.execute-api.us-east-2.amazonaws.com/prod\";\n\nvar EditPost = function EditPost(props) {\n  var _useState = useState(props.blogItem.title),\n      title = _useState[0],\n      setTitle = _useState[1];\n\n  var _useState2 = useState(props.blogItem.content),\n      content = _useState2[0],\n      setContent = _useState2[1];\n\n  var _useState3 = useState(props.blogItem.category),\n      category = _useState3[0],\n      setCategory = _useState3[1];\n\n  var _useState4 = useState(props.blogItem.image_url),\n      imageLocation = _useState4[0],\n      setImageLocation = _useState4[1];\n\n  var _useState5 = useState(props.blogItem.is_draft),\n      draft = _useState5[0],\n      setDraft = _useState5[1];\n\n  var _useState6 = useState(props.blogItem.is_published),\n      isPublished = _useState6[0],\n      setIsPublish = _useState6[1];\n\n  var _useState7 = useState(false),\n      isLoading = _useState7[0],\n      setIsLoading = _useState7[1];\n\n  var _useState8 = useState(null),\n      error = _useState8[0],\n      setError = _useState8[1];\n\n  var _useCookies = useCookies(['token']),\n      _useCookies2 = _slicedToArray(_useCookies, 2),\n      cookies = _useCookies2[0],\n      setCookie = _useCookies2[1];\n\n  var router = useRouter();\n  useEffect(function () {\n    if (props.loggedIn == false) {\n      window.location.href = '/admin/login';\n    }\n  });\n\n  var handleChange = function handleChange(value) {\n    console.log(\"value \", value);\n    setContent(value);\n  };\n\n  var handleTitle = function handleTitle(e) {\n    e.preventDefault();\n    setPostTitle(e.target.value);\n    console.log(postTitle);\n  };\n\n  var handleUpdate = function handleUpdate() {\n    console.log(\"cookies \", cookies);\n    console.log(\"this is the image location: \", imageLocation);\n    var token = cookies['token'];\n\n    if (title == \"\" || content == \"\") {\n      console.log(\"family\", postTitle, content);\n      setError(\"Empty title or Content\");\n    } else {\n      console.log(\"content \", content);\n      console.log(\"title \", title);\n      setIsLoading(true);\n      var API = POST_API + \"/\".concat(props.blogItem.id);\n      console.log(\"this is the update api \", API);\n      fetch(API, {\n        method: 'PUT',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer ' + token\n        },\n        body: JSON.stringify({\n          title: title,\n          content: content,\n          image_url: imageLocation,\n          category: category,\n          is_draft: draft,\n          is_published: isPublished\n        })\n      }).then(function (response) {\n        return response.json();\n      }).then(function (data) {\n        console.log(data);\n        router.push('/admin/posts');\n        setIsLoading(false);\n      })[\"catch\"](function (error) {\n        setIsLoading(false);\n        console.log(error);\n      });\n    }\n  };\n\n  var handleImageUpload = function handleImageUpload(e) {\n    e.preventDefault();\n    console.log(e.target.files[0].name);\n    console.log(e.target.files[0].type);\n    var file = e.target.files[0];\n    var reader = new FileReader();\n    reader.addEventListener('loadend', function (e) {\n      fetch(apiBaseURL + \"/requestUploadURL\", {\n        method: \"POST\",\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          name: file.name,\n          type: file.type\n        })\n      }).then(function (response) {\n        return response.json();\n      }).then(function (json) {\n        console.log(json);\n        var img = 'https://slsuploadabi.s3.us-east-2.amazonaws.com/' + file.name;\n        console.log(\"image location after post \", img);\n        setImageLocation(img);\n        return fetch(json.uploadURL, {\n          method: \"PUT\",\n          body: new Blob([reader.result], {\n            type: file.type\n          })\n        });\n      })[\"catch\"](function (error) {\n        setIsLoading(false);\n        console.log(error);\n      });\n    });\n    reader.readAsArrayBuffer(file);\n  };\n\n  var handleCategory = function handleCategory(e) {\n    console.log(e.target.id);\n    setCategory(e.target.id);\n  };\n\n  var handleCancel = function handleCancel() {\n    Router.push('/admin/posts');\n  };\n\n  var modules = {\n    toolbar: [[{\n      'header': '1'\n    }, {\n      'header': '2'\n    }, {\n      'font': []\n    }], [{\n      size: []\n    }], ['bold', 'italic', 'underline', 'strike', 'blockquote'], [{\n      'list': 'ordered'\n    }, {\n      'list': 'bullet'\n    }, {\n      'indent': '-1'\n    }, {\n      'indent': '+1'\n    }], ['link', 'image', 'video'], ['clean']],\n    clipboard: {\n      // toggle to add extra line breaks when pasting HTML:\n      matchVisual: false\n    }\n  };\n  /*\n   * Quill editor formats\n   * See https://quilljs.com/docs/formats/\n   */\n\n  var formats = ['header', 'font', 'size', 'bold', 'italic', 'underline', 'strike', 'blockquote', 'list', 'bullet', 'indent', 'link', 'image', 'video'];\n  return __jsx(LoadingOverlay, {\n    active: isLoading,\n    spinner: true,\n    text: \"Loading your content...\"\n  }, __jsx(AdminLayout, {\n    sidebar: true\n  }, __jsx(\"main\", {\n    className: \"jsx-2430398980\" + \" \" + \"main-content col-lg-10 col-md-9 col-sm-12 p-0 offset-lg-2 offset-md-3\"\n  }, __jsx(MainNav, null), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"main-content-container container-fluid px-4\"\n  }, error == null ? \"\" : __jsx(\"div\", {\n    role: \"alert\",\n    className: \"jsx-2430398980\" + \" \" + \"alert alert-danger\"\n  }, error), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"page-header row no-gutters py-4\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"col-12 col-sm-4 text-center text-sm-left mb-0\"\n  }, __jsx(\"span\", {\n    className: \"jsx-2430398980\" + \" \" + \"text-uppercase page-subtitle\"\n  }, \"Update Post\"), __jsx(\"h3\", {\n    className: \"jsx-2430398980\" + \" \" + \"page-title\"\n  }, title))), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"row\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"col-lg-9 col-md-12\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"card card-small mb-3\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"card-body\"\n  }, __jsx(\"form\", {\n    className: \"jsx-2430398980\" + \" \" + \"add-new-post\"\n  }, __jsx(\"input\", {\n    type: \"text\",\n    defaultValue: title,\n    placeholder: title,\n    onChange: function onChange(e) {\n      return setTitle(e.target.value);\n    },\n    className: \"jsx-2430398980\" + \" \" + \"form-control form-control-lg mb-3\"\n  }), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"add-new-post__editor mb-1\"\n  }, __jsx(QuillNoSSRWrapper, {\n    modules: modules,\n    formats: formats,\n    theme: \"snow\",\n    defaultValue: content,\n    onChange: handleChange\n  })), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"form-group files color\"\n  }, __jsx(\"label\", {\n    className: \"jsx-2430398980\"\n  }, \"Upload Your Image \"), __jsx(\"input\", {\n    \"data-required\": \"image\",\n    type: \"file\",\n    multiple: \"\",\n    onChange: handleImageUpload,\n    className: \"jsx-2430398980\" + \" \" + \"form-control\"\n  })))))), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"col-lg-3 col-md-12\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + 'card card-small mb-3'\n  }, __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"card-header border-bottom\"\n  }, __jsx(\"h6\", {\n    className: \"jsx-2430398980\" + \" \" + \"m-0\"\n  }, \"Categories\")), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + 'card-body p-0'\n  }, __jsx(\"ul\", {\n    className: \"jsx-2430398980\" + \" \" + \"list-group list-group-flush\"\n  }, __jsx(\"li\", {\n    className: \"jsx-2430398980\" + \" \" + \"list-group-item px-3 pb-2\"\n  }, __jsx(\"fieldset\", {\n    className: \"jsx-2430398980\"\n  }, __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"form-check custom-radio mb-1\"\n  }, __jsx(\"input\", {\n    type: \"radio\",\n    name: \"category\",\n    onChange: function onChange(e) {\n      return setCategory(e.target.value);\n    },\n    id: \"Uncategorized\",\n    value: \"Uncategorized\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-input\"\n  }), __jsx(\"label\", {\n    \"for\": \"Uncategorized\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-label\"\n  }, \"Uncategorized\")), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"form-check custom-radio mb-1\"\n  }, __jsx(\"input\", {\n    type: \"radio\",\n    name: \"category\",\n    onChange: function onChange(e) {\n      return setCategory(e.target.value);\n    },\n    id: \"Design\",\n    value: \"Design\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-input\"\n  }), __jsx(\"label\", {\n    \"for\": \"Design\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-label\"\n  }, \"Design\")), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"form-check custom-radio mb-1\"\n  }, __jsx(\"input\", {\n    type: \"radio\",\n    name: \"category\",\n    onChange: function onChange(e) {\n      return setCategory(e.target.value);\n    },\n    id: \"Development\",\n    value: \"Development\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-input\"\n  }), __jsx(\"label\", {\n    \"for\": \"Development\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-label\"\n  }, \"Development\")), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"form-check custom-radio mb-1\"\n  }, __jsx(\"input\", {\n    type: \"radio\",\n    name: \"category\",\n    onChange: function onChange(e) {\n      return setCategory(e.target.value);\n    },\n    id: \"Writing\",\n    value: \"Writing\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-input\"\n  }), __jsx(\"label\", {\n    \"for\": \"Writing\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-label\"\n  }, \"Writing\")), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"form-check custom-radio mb-1\"\n  }, __jsx(\"input\", {\n    type: \"radio\",\n    name: \"category\",\n    onChange: function onChange(e) {\n      return setCategory(e.target.value);\n    },\n    id: \"Books\",\n    value: \"Books\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-input\"\n  }), __jsx(\"label\", {\n    \"for\": \"Books\",\n    className: \"jsx-2430398980\" + \" \" + \"form-check-label\"\n  }, \"Books\"))))))), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + 'card card-small mb-3'\n  }, __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"card-header border-bottom\"\n  }, __jsx(\"h6\", {\n    className: \"jsx-2430398980\" + \" \" + \"m-0\"\n  }, \"Actions\")), __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + 'card-body p-0'\n  }, __jsx(\"ul\", {\n    className: \"jsx-2430398980\" + \" \" + \"list-group list-group-flush\"\n  }, __jsx(\"li\", {\n    className: \"jsx-2430398980\" + \" \" + \"list-group-item p-3\"\n  }, __jsx(\"span\", {\n    className: \"jsx-2430398980\" + \" \" + \"d-flex mb-2\"\n  }, __jsx(\"i\", {\n    className: \"jsx-2430398980\" + \" \" + \"material-icons mr-1\"\n  }, \"flag\"), __jsx(\"strong\", {\n    className: \"jsx-2430398980\" + \" \" + \"mr-1\"\n  }, \"Status:\"), \" Draft\", __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"custom-control custom-checkbox mb-1 ml-auto\"\n  }, __jsx(\"input\", {\n    type: \"checkbox\",\n    defaultValue: draft,\n    onChange: function onChange(e) {\n      return setDraft(e.target.value);\n    },\n    id: \"draft\",\n    className: \"jsx-2430398980\" + \" \" + \"custom-control-input\"\n  }), __jsx(\"label\", {\n    htmlFor: \"draft\",\n    className: \"jsx-2430398980\" + \" \" + \"custom-control-label\"\n  }))), __jsx(\"span\", {\n    className: \"jsx-2430398980\" + \" \" + \"d-flex mb-2\"\n  }, __jsx(\"i\", {\n    className: \"jsx-2430398980\" + \" \" + \"material-icons mr-1\"\n  }, \"calendar_today\"), __jsx(\"strong\", {\n    className: \"jsx-2430398980\" + \" \" + \"mr-1\"\n  }, \"Schedule:\"), \" Now\", __jsx(\"div\", {\n    className: \"jsx-2430398980\" + \" \" + \"custom-control custom-checkbox mb-1 ml-auto\"\n  }, __jsx(\"input\", {\n    type: \"checkbox\",\n    defaultValue: isPublished,\n    onChange: function onChange(e) {\n      return setIsPublish(e.target.value);\n    },\n    id: \"schedule\",\n    className: \"jsx-2430398980\" + \" \" + \"custom-control-input\"\n  }), __jsx(\"label\", {\n    htmlFor: \"schedule\",\n    className: \"jsx-2430398980\" + \" \" + \"custom-control-label\"\n  }))), __jsx(\"span\", {\n    className: \"jsx-2430398980\" + \" \" + \"d-flex\"\n  }, __jsx(\"i\", {\n    className: \"jsx-2430398980\" + \" \" + \"material-icons mr-1\"\n  }, \"score\"), __jsx(\"strong\", {\n    className: \"jsx-2430398980\" + \" \" + \"mr-1\"\n  }, \"Readability:\"), __jsx(\"strong\", {\n    className: \"jsx-2430398980\" + \" \" + \"text-warning\"\n  }, \"Ok\"))), __jsx(\"li\", {\n    className: \"jsx-2430398980\" + \" \" + \"list-group-item d-flex px-3\"\n  }, __jsx(\"button\", {\n    onClick: handleCancel,\n    className: \"jsx-2430398980\" + \" \" + \"btn btn-sm btn-outline-accent\"\n  }, __jsx(\"i\", {\n    className: \"jsx-2430398980\" + \" \" + \"material-icons\"\n  }, \"save\"), \" Cancel\"), __jsx(\"button\", {\n    onClick: handleUpdate,\n    className: \"jsx-2430398980\" + \" \" + \"btn btn-sm btn-accent ml-auto\"\n  }, __jsx(\"i\", {\n    className: \"jsx-2430398980\" + \" \" + \"material-icons\"\n  }, \"file_copy\"), \" Update\")))))))), __jsx(\"footer\", {\n    className: \"jsx-2430398980\" + \" \" + \"main-footer d-flex p-2 px-3 bg-white border-top\"\n  }, __jsx(\"ul\", {\n    className: \"jsx-2430398980\" + \" \" + \"nav\"\n  }, __jsx(\"li\", {\n    className: \"jsx-2430398980\" + \" \" + \"nav-item\"\n  }, __jsx(\"a\", {\n    href: \"#\",\n    className: \"jsx-2430398980\" + \" \" + \"nav-link\"\n  }, \"Home\")), __jsx(\"li\", {\n    className: \"jsx-2430398980\" + \" \" + \"nav-item\"\n  }, __jsx(\"a\", {\n    href: \"#\",\n    className: \"jsx-2430398980\" + \" \" + \"nav-link\"\n  }, \"Services\")), __jsx(\"li\", {\n    className: \"jsx-2430398980\" + \" \" + \"nav-item\"\n  }, __jsx(\"a\", {\n    href: \"#\",\n    className: \"jsx-2430398980\" + \" \" + \"nav-link\"\n  }, \"About\")), __jsx(\"li\", {\n    className: \"jsx-2430398980\" + \" \" + \"nav-item\"\n  }, __jsx(\"a\", {\n    href: \"#\",\n    className: \"jsx-2430398980\" + \" \" + \"nav-link\"\n  }, \"Products\")), __jsx(\"li\", {\n    className: \"jsx-2430398980\" + \" \" + \"nav-item\"\n  }, __jsx(\"a\", {\n    href: \"#\",\n    className: \"jsx-2430398980\" + \" \" + \"nav-link\"\n  }, \"Blog\"))), __jsx(\"span\", {\n    className: \"jsx-2430398980\" + \" \" + \"copyright ml-auto my-auto mr-2\"\n  }, \"Copyright \\xA9 2018\", __jsx(\"a\", {\n    href: \"https://designrevision.com\",\n    rel: \"nofollow\",\n    className: \"jsx-2430398980\"\n  }, \"DesignRevision\")))), __jsx(_JSXStyle, {\n    id: \"2430398980\"\n  }, [\".files.jsx-2430398980 input.jsx-2430398980{outline:2px dashed #92b0b3;outline-offset:-10px;-webkit-transition:outline-offset .15s ease-in-out,background-color .15s linear;-webkit-transition:outline-offset .15s ease-in-out,background-color .15s linear;transition:outline-offset .15s ease-in-out,background-color .15s linear;padding:120px 0px 85px 35%;text-align:center !important;margin:0;width:100% !important;}\", \".files.jsx-2430398980 input.jsx-2430398980:focus{outline:2px dashed #92b0b3;outline-offset:-10px;-webkit-transition:outline-offset .15s ease-in-out,background-color .15s linear;-webkit-transition:outline-offset .15s ease-in-out,background-color .15s linear;transition:outline-offset .15s ease-in-out,background-color .15s linear;border:1px solid #92b0b3;}\", \".files.jsx-2430398980{position:relative;}\", \".files.jsx-2430398980:after{pointer-events:none;position:absolute;top:60px;left:0;width:50px;right:0;height:56px;content:\\\"\\\";background-image:url(https://image.flaticon.com/icons/png/128/109/109612.png);display:block;margin:0 auto;background-size:100%;background-repeat:no-repeat;}\", \".color.jsx-2430398980 input.jsx-2430398980{background-color:#f1f1f1;}\", \".files.jsx-2430398980:before{position:absolute;bottom:10px;left:0;pointer-events:none;width:100%;right:0;height:57px;content:\\\" or drag it here. \\\";display:block;margin:0 auto;color:#2ea591;font-weight:600;text-transform:capitalize;text-align:center;}\"])));\n};\n\nEditPost.getInitialProps = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(context) {\n    var auth_token, AUTHORIZE, headers, res, data, id, API, post_res, _data;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            // getting token from cookies\n            auth_token = cookies(context).token;\n            console.log(\"this is the token \", auth_token);\n            console.log(context.query);\n            AUTHORIZE = \"https://gwh3ump9m0.execute-api.us-east-2.amazonaws.com/prod/api/secret\"; // getting current logged in user with the token\n\n            headers = {\n              method: 'GET',\n              headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json',\n                'Authorization': 'Bearer ' + auth_token\n              }\n            };\n            _context.next = 7;\n            return fetch(AUTHORIZE, headers);\n\n          case 7:\n            res = _context.sent;\n            _context.next = 10;\n            return res.json();\n\n          case 10:\n            data = _context.sent;\n            console.log(data);\n\n            if (!data.valid) {\n              _context.next = 26;\n              break;\n            }\n\n            console.log(\"valid token\");\n            id = context.query.id;\n            API = POST_API + \"\".concat(id);\n            console.log(\"this is the API\", API);\n            _context.next = 19;\n            return fetch(POST_API + \"/\".concat(id));\n\n          case 19:\n            post_res = _context.sent;\n            _context.next = 22;\n            return post_res.json();\n\n          case 22:\n            _data = _context.sent;\n            return _context.abrupt(\"return\", {\n              loggedIn: true,\n              blogItem: _data\n            });\n\n          case 26:\n            console.log(\"invalid token\");\n            return _context.abrupt(\"return\", {\n              loggedIn: false,\n              blogItem: data\n            });\n\n          case 28:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexport default EditPost;","map":null,"metadata":{},"sourceType":"module"}